#!/usr/bin/env bash

# Exit immediately if a command exits with a non-zero status.
set -e
# This setting ensures that pipes will return an error code if any command in the pipe fails.
set -o pipefail

# Resolve symlinks
CURRENT_FILE="$(cd "$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")" && pwd)"
WEX_ROOT="$(realpath "${CURRENT_FILE}/../")/"
WEX_PROC_ID="$$.$(date +%s.%N)"

# Load main python script
python3 "${WEX_ROOT}__main__.py" "${WEX_PROC_ID}" "${@}"

# If a post-exec process has been defined.
WEX_POST_EXEC="${WEX_ROOT}tmp/process/${WEX_PROC_ID}.post-exec"
if [ -f "${WEX_POST_EXEC}" ];then
  . "${WEX_POST_EXEC}"
  rm "${WEX_POST_EXEC}"
fi

# TODO TEMP
echo "end"